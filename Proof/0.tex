
\section*{Legend}
$$
D = \text{Total DPS over the fight}
$$
$$
T = \text{Fight length in seconds}
$$
$$
R_j = \text{Raw damage of the $j^\text{th}$ shadow bolt,} \ j \in \{ 1, ..., N \}
$$
$$
N = \text{Number of shadow bolts cast}
$$


\section*{Total DPS Equation}
%
First note that if there is no life tapping needed for the fight, we have
%
$$
N = \left\lfloor \frac{T}{2.5} \right\rfloor
$$
%
and the total damage over time will be the sum of all the random damage from each cast
%
$$
D = \sum_{j=1}^N R_j
$$
%
and each damage draw is
%
$$
R_j = (B_j + \frac{3}{3.5} s) H_j (2 C_j + 1)
$$
%
where $B_j$ is the random base damage of the $j^\text{th}$ cast, $s$ is the spell power of the caster, $H_j$ is the binary outcome of the spell hit occurring with probability $\min \{ 0.83 + p, 0.99 \}$ where $p$ is the caster's hit chance, and $C_j$ is likewise the binary event of a critical strike occurring with probability equal to the caster's crit chance.

Technically, the value of $B_j$ is drawn uniformly, but the true distribution for the sum of these is difficult to work with so I'll approximate $D$ as Normal in the limit of large $N$.



\section*{Extending to Life Tap}
%
Longer fights require Life Tap, even with the use of Demonic Runes or Mana Potions. In this case, we have
%
$$
N = \left\lfloor \frac{T-L}{2.5} \right\rfloor
$$
%
where $L$ is the time spent life tapping. If we have $M$ total life taps during the fight, then
%
$$
L = 1.5 M
$$
%
by the Global Cooldown (GCD)... Fill in details of iterative solver for N



\section*{Expected Value}
%
$$
\E[R_j] = \E\left[ (B_j + \frac{3}{3.5} s) H_j (2 C_j + 1) \right]
= (\E[B_j] + \frac{3}{3.5} s) \E[H_j] (2 \E[C_j] + 1)
$$
$$
= (\frac{a_k + b_k}{2} + \frac{3}{3.5} s) p (2 q + 1)
$$
%
where $a_k$ is the lower bound of the base shadow bolt damage of rank $k$. Likewise, $b_j^k$ is this upper bound.



\section*{Variability}
%
$$
\V[R_j] = \V\left[ (B_j + \frac{3}{3.5} s) H_j (2 C_j + 1) \right]
$$
$$
= (\V\left[ B_j + \frac{3}{3.5} s \right] + \E^2\left[ B_j + \frac{3}{3.5} s \right])
(\V\left[ H_j \right] + \E^2\left[ H_j \right])
(\V\left[ 2 C_j + 1 \right] + \E^2\left[ 2 C_j + 1 \right])
$$
$$
- \E^2\left[ B_j + \frac{3}{3.5} s \right] \E^2\left[ H_j \right] \E^2\left[ 2 C_j + 1 \right]
$$
$$
= (\V\left[ B_j \right] + ( \E\left[ B_j \right] + \frac{3}{3.5} s)^2)
(p (1 - p) + p^2)
( (1.5 + 0.5 \mathbb{I}(\text{ruin}))^2 \V\left[ C_j \right] + ((1.5 + 0.5 \mathbb{I}(\text{ruin})) \E\left[ C_j \right] + 1)^2)
$$
$$
- (\E\left[ B_j \right] + \frac{3}{3.5} s)^2 p^2 ((1.5 + 0.5 \mathbb{I}(\text{ruin})) \E\left[ C_j \right] + 1)^2
$$
$$
= (\frac{(b_k-a_k)^2}{12} + ( \frac{a_k + b_k}{2} + \frac{3}{3.5} s)^2)
p
( (1.5 + 0.5 \mathbb{I}(\text{ruin}))^2 q (1 - q) + ((1.5 + 0.5 \mathbb{I}(\text{ruin})) q + 1)^2)
$$
$$
- (\frac{a_k + b_k}{2} + \frac{3}{3.5} s)^2 p^2 ((1.5 + 0.5 \mathbb{I}(\text{ruin})) q + 1)^2
$$
%
where $a_j^k$ is the lower bound of the base shadow bolt damage of rank $k$ on the $j^\text{th}$ cast. Likewise, $b_j^k$ is this upper bound.

